name: Keep Backend Alive

on:
  schedule:
    # Run every 10 minutes to prevent Render free tier from sleeping
    # Render free tier spins down after 15 minutes of inactivity
    - cron: "*/10 * * * *"

  # Allow manual trigger for testing
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest

    steps:
      - name: Ping Backend Health Endpoint
        run: |
          echo "========================================="
          echo "üèì Pinging backend at $(date)"
          echo "========================================="

          # Ping the backend health endpoint
          response=$(curl -s -o /dev/null -w "%{http_code}" ${{ secrets.BACKEND_URL }}/api/health)

          echo "üì° Response code: $response"

          # Check if response is successful
          if [ $response -eq 200 ]; then
            echo "‚úÖ Backend is alive and responding!"
            
            # Get full response for verification
            full_response=$(curl -s ${{ secrets.BACKEND_URL }}/api/health)
            echo "üìÑ Response body: $full_response"
          else
            echo "‚ùå Backend returned unexpected status code: $response"
            echo "‚ö†Ô∏è  This might indicate the backend is down or experiencing issues"
            exit 1
          fi

          echo "========================================="
          echo "‚úÖ Keep-alive ping completed successfully"
          echo "========================================="

      - name: Summary
        if: success()
        run: |
          echo "Backend is healthy and will not spin down"
          echo "Next ping in 10 minutes"
